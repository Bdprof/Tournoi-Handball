<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>ü§æ Tournoi Handball</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;width:100%;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#1e3a8a 0%,#3b82f6 50%,#60a5fa 100%);color:#fff}
.page{height:100vh;overflow-y:auto;padding:15px 15px 80px;display:none}
.page.active{display:block}
.card{background:rgba(255,255,255,.15);backdrop-filter:blur(20px);border-radius:20px;padding:20px;margin-bottom:15px;box-shadow:0 12px 40px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.2)}
h1{font-size:1.8rem;margin-bottom:15px;text-align:center;text-shadow:0 4px 12px rgba(0,0,0,.3);font-weight:800}
h2{font-size:1.3rem;margin-bottom:15px;font-weight:700}
.btn{padding:12px 20px;border:none;border-radius:12px;font-size:1rem;font-weight:700;cursor:pointer;transition:.2s;box-shadow:0 8px 20px rgba(0,0,0,.25);min-height:50px;text-transform:uppercase;letter-spacing:.5px}
.btn:active{transform:scale(.95)}
.btn-primary{background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff}
.btn-success{background:linear-gradient(135deg,#11998e,#38ef7d);color:#fff}
.btn-danger{background:linear-gradient(135deg,#ee0979,#ff6a00);color:#fff}
.btn-warning{background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff}
.btn-secondary{background:rgba(255,255,255,.25);color:#fff;border:3px solid rgba(255,255,255,.4)}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:15px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.counter{display:flex;align-items:center;gap:12px;margin:10px 0}
.counter button{width:50px;height:50px;font-size:1.8rem;background:rgba(255,255,255,.2);border:3px solid rgba(255,255,255,.4);color:#fff;border-radius:16px;cursor:pointer;font-weight:900}
.counter span{flex:1;text-align:center;font-size:1.8rem;font-weight:900}
.color-badge{width:48px;height:48px;border-radius:50%;border:4px solid rgba(255,255,255,.5);box-shadow:0 4px 12px rgba(0,0,0,.3)}
select{flex:1;padding:15px;border-radius:12px;border:3px solid rgba(255,255,255,.3);background:rgba(255,255,255,.15);color:#fff;font-size:1.1rem;font-weight:600;min-height:56px}
input[type="checkbox"]{width:32px;height:32px;cursor:pointer}
input[type="text"]{width:100%;padding:18px;border-radius:12px;border:3px solid rgba(255,255,255,.3);background:rgba(255,255,255,.15);color:#fff;font-size:1.1rem;margin:10px 0;font-weight:600}
input[type="text"]::placeholder{color:rgba(255,255,255,.6)}
input[type="number"]{padding:10px;border-radius:8px;border:2px solid rgba(255,255,255,.3);background:rgba(255,255,255,.15);color:#fff;font-size:1rem;font-weight:600;text-align:center}
.ranking-table{width:100%;border-collapse:collapse;margin:20px 0}
.ranking-table th{background:rgba(255,255,255,.2);padding:8px 4px;font-size:.75rem;border-bottom:3px solid rgba(255,255,255,.3);font-weight:700}
.ranking-table td{padding:8px 4px;text-align:center;border-bottom:1px solid rgba(255,255,255,.1);font-size:.8rem}
.timer{font-size:2.5rem;font-weight:900;text-align:center;padding:15px;background:rgba(255,255,255,.2);border-radius:20px;margin:15px 0}
.possession-zone{padding:25px 20px;border-radius:20px;text-align:center;margin:15px 0;box-shadow:0 8px 24px rgba(0,0,0,.3)}
.score-display{display:flex;justify-content:space-around;margin:15px 0;padding:15px;background:rgba(255,255,255,.15);border-radius:20px}
.score-item .score{font-size:2.5rem;font-weight:900;margin-top:8px}
.action-btn{padding:18px 12px;font-size:1rem;border-radius:16px;border:none;cursor:pointer;font-weight:800;min-height:60px;box-shadow:0 8px 24px rgba(0,0,0,.3);display:flex;align-items:center;justify-content:center;gap:6px}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:1000;align-items:center;justify-content:center;padding:20px;overflow-y:auto}
.modal.active{display:flex}
.modal-content{background:linear-gradient(135deg,#1e3a8a,#3b82f6);border-radius:24px;padding:35px;max-width:550px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.5);border:2px solid rgba(255,255,255,.2);max-height:90vh;overflow-y:auto}
.team-selector{display:flex;align-items:center;gap:15px;padding:18px;background:rgba(0,0,0,.2);border-radius:16px;margin-bottom:12px}
</style>
</head>
<body>

<div id="p1" class="page active">
<h1>ü§æ TOURNOI HANDBALL</h1>
<div class="card">
<h2>‚öôÔ∏è Configuration</h2>
<div style="margin:25px 0">
<strong style="display:block;margin-bottom:15px;font-size:1.2rem">Nombre d'√©quipes :</strong>
<div class="grid-4">
<button class="btn btn-secondary" onclick="setTeams(3)">3</button>
<button class="btn btn-primary" onclick="setTeams(4)">4</button>
<button class="btn btn-secondary" onclick="setTeams(5)">5</button>
<button class="btn btn-secondary" onclick="setTeams(6)">6</button>
</div>
</div>
<div style="margin:25px 0">
<strong style="font-size:1.2rem">Dur√©e (minutes) :</strong>
<div class="counter">
<button onclick="adjustDuration(-1)">‚àí</button>
<span id="dur">5</span>
<button onclick="adjustDuration(1)">+</button>
</div>
</div>
<div style="margin:25px 0">
<strong style="font-size:1.2rem">Points par but :</strong>
<div class="counter">
<button onclick="adjustPoints(-1)">‚àí</button>
<span id="pts">1</span>
<button onclick="adjustPoints(1)">+</button>
</div>
</div>
</div>
<button class="btn btn-success" style="width:100%;margin-top:25px;font-size:1.3rem" onclick="goToPage2()">SUIVANT ‚Üí</button>
</div>

<div id="p2" class="page">
<h1>üé® PERSONNALISATION</h1>
<div class="card">
<h2>Couleurs des √©quipes</h2>
<div id="teamsList"></div>
</div>
<button class="btn btn-success" style="width:100%;margin-top:25px;font-size:1.3rem" onclick="startTournament()">D√âMARRER üöÄ</button>
</div>

<div id="p3" class="page">
<h1>üèÜ TOURNOI HANDBALL</h1>
<div class="card">
<h2>üìä CLASSEMENT</h2>
<table class="ranking-table" id="rankingTable"></table>
</div>
<div class="card">
<h2>‚öΩ MATCHS</h2>
<div id="matchesList"></div>
</div>
<button class="btn btn-danger" style="width:100%;margin-top:25px;font-size:1.3rem" onclick="resetTournament()">üîÑ NOUVEAU TOURNOI</button>
</div>

<div id="p4" class="page">
<div style="text-align:center;margin:20px 0">
<div class="timer" id="timer">5:00</div>
</div>
<div id="startPhase" class="card">
<h2 style="text-align:center">QUI ENGAGE ?</h2>
<div class="grid-2" style="margin-top:25px" id="startButtons"></div>
<button class="btn btn-success" style="width:100%;margin-top:25px;display:none;font-size:1.3rem" id="launchBtn" onclick="launchMatch()">‚ñ∂Ô∏è LANCER LE MATCH</button>
</div>
<div id="gamePhase" style="display:none">
<div class="possession-zone" id="possessionZone">
<h2 id="possessionTeam" style="margin-bottom:10px;font-size:1.5rem"></h2>
<div style="font-size:1.1rem;opacity:.9">ü§æ POSSESSION</div>
</div>
<div class="score-display">
<div class="score-item" style="text-align:center">
<span id="teamName1"></span>
<div class="score" id="score1">0</div>
</div>
<div class="score-item" style="text-align:center">
<span id="teamName2"></span>
<div class="score" id="score2">0</div>
</div>
</div>
<div class="action-buttons" style="margin:15px 0">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px">
<button class="action-btn" style="background:linear-gradient(135deg,#11998e,#38ef7d);color:#fff" onclick="scoreGoal()">ü•Ö BUT</button>
<button class="action-btn" style="background:linear-gradient(135deg,#ee0979,#ff6a00);color:#fff" onclick="missedShot()">‚ùå TIR RAT√â</button>
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px">
<button class="action-btn" style="background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff" onclick="turnover()">üîÑ PERTE</button>
<button class="action-btn" style="background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff" onclick="endMatch()">üèÅ TERMINER</button>
</div>
</div>
</div>
<button class="btn btn-primary" style="width:100%;margin-top:25px;font-size:1.2rem" onclick="backToTournament()">‚Üê RETOUR</button>
</div>

<script>
const colors=[{n:'Blanc',c:'#FFFFFF'},{n:'Noir',c:'#1a1a1a'},{n:'Bleu',c:'#3b82f6'},{n:'Rouge',c:'#ef4444'},{n:'Vert',c:'#10b981'},{n:'Jaune',c:'#fbbf24'},{n:'Orange',c:'#f97316'},{n:'Violet',c:'#8b5cf6'},{n:'Rose',c:'#ec4899'},{n:'Cyan',c:'#06b6d4'}];

const MATCHUPS={3:[[0,1],[0,2],[1,2]],4:[[0,1],[2,3],[0,2],[1,3],[0,3],[1,2]],5:[[0,1],[2,3],[0,4],[1,2],[3,4],[0,2],[1,3],[2,4],[0,3],[1,4]],6:[[0,1],[2,3],[4,5],[0,2],[1,3],[4,1],[5,2],[0,4],[3,5],[0,3],[1,2],[4,5]]};

let state={
  numTeams:4,duration:5,pointsPerGoal:1,
  teams:[],matches:[],currentMatchIdx:null,score1:0,score2:0,possession:1,
  matchStarted:false,timeLeft:300,timerInterval:null,timerRunning:false,
  shots1:0,shots2:0,possessions1:0,possessions2:0,missedShots1:0,missedShots2:0
};

function setTeams(n){
  state.numTeams=n;
  const btns=document.querySelectorAll('#p1 .grid-4 .btn');
  btns.forEach((btn,i)=>{
    btn.className=i===[3,4,5,6].indexOf(n)?'btn btn-primary':'btn btn-secondary';
  });
}

function adjustDuration(d){
  state.duration=Math.max(1,Math.min(60,state.duration+d));
  document.getElementById('dur').textContent=state.duration;
}

function adjustPoints(d){
  state.pointsPerGoal=Math.max(1,Math.min(10,state.pointsPerGoal+d));
  document.getElementById('pts').textContent=state.pointsPerGoal;
}

function goToPage2(){
  state.teams=colors.slice(0,state.numTeams).map((c,i)=>({id:i+1,color:c.c,name:c.n}));
  renderTeamsList();
  showPage('p2');
}

function renderTeamsList(){
  let html='';
  state.teams.forEach((t,i)=>{
    html+=`<div class="team-selector"><span style="font-weight:bold;font-size:1.3rem;width:40px">${t.id}</span><div class="color-badge" style="background:${t.color}"></div><select onchange="changeTeamColor(${i},this.value)">`;
    colors.forEach(c=>{
      html+=`<option value="${c.c}"${c.c===t.color?' selected':''}>${c.n}</option>`;
    });
    html+='</select></div>';
  });
  document.getElementById('teamsList').innerHTML=html;
}

function changeTeamColor(idx,color){
  const found=colors.find(c=>c.c===color);
  if(found){
    state.teams[idx].color=found.c;
    state.teams[idx].name=found.n;
    renderTeamsList();
  }
}

function startTournament(){
  generateMatches();
  showPage('p3');
  updateRanking();
  updateMatches();
}

function generateMatches(){
  state.matches=[];
  const pairs=MATCHUPS[state.numTeams];
  pairs.forEach(pair=>{
    state.matches.push({
      t1:state.teams[pair[0]],t2:state.teams[pair[1]],s1:0,s2:0,winner:null,
      played:false,stats:{shots1:0,shots2:0,poss1:0,poss2:0,missedShots1:0,missedShots2:0}
    });
  });
}

function updateRanking(){
  const rankings=state.teams.map(t=>({team:t,points:0,wins:0,draws:0,losses:0,goalsFor:0,goalsAgainst:0}));
  
  state.matches.forEach(m=>{
    if(!m.played)return;
    const r1=rankings.find(r=>r.team.id===m.t1.id);
    const r2=rankings.find(r=>r.team.id===m.t2.id);
    
    r1.goalsFor+=m.s1;r1.goalsAgainst+=m.s2;
    r2.goalsFor+=m.s2;r2.goalsAgainst+=m.s1;
    
    if(m.s1>m.s2){r1.points+=3;r1.wins++;r2.losses++;}
    else if(m.s2>m.s1){r2.points+=3;r2.wins++;r1.losses++;}
    else{r1.points++;r2.points++;r1.draws++;r2.draws++;}
  });
  
  rankings.sort((a,b)=>{
    if(b.points!==a.points)return b.points-a.points;
    return(b.goalsFor-b.goalsAgainst)-(a.goalsFor-a.goalsAgainst);
  });
  
  let html='<tr><th>Pos</th><th>√âquipe</th><th>Pts</th><th>V-N-D</th><th>BP:BC</th></tr>';
  rankings.forEach((r,i)=>{
    html+=`<tr><td>${i+1}</td><td>${r.team.name}</td><td>${r.points}</td><td>${r.wins}-${r.draws}-${r.losses}</td><td>${r.goalsFor}:${r.goalsAgainst}</td></tr>`;
  });
  document.getElementById('rankingTable').innerHTML=html;
}

function updateMatches(){
  let html='';
  state.matches.forEach((m,i)=>{
    const status=m.played?`${m.s1}-${m.s2}`:'√Ä jouer';
    html+=`<div class="card" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><div>${m.t1.name} vs ${m.t2.name}</div><div style="font-weight:bold">${status}</div>`;
    if(!m.played){
      html+=`<button class="btn btn-primary" style="padding:8px 16px;font-size:.9rem" onclick="playMatch(${i})">JOUER</button>`;
    }
    html+='</div>';
  });
  document.getElementById('matchesList').innerHTML=html;
}

function playMatch(idx){
  state.currentMatchIdx=idx;
  const m=state.matches[idx];
  state.score1=0;state.score2=0;state.possession=1;state.matchStarted=false;
  state.timeLeft=state.duration*60;state.timerRunning=false;
  state.shots1=0;state.shots2=0;state.possessions1=0;state.possessions2:0;state.missedShots1=0;state.missedShots2=0;
  
  document.getElementById('teamName1').textContent=m.t1.name;
  document.getElementById('teamName2').textContent=m.t2.name;
  
  const txtColor1=m.t1.color==='#FFFFFF'||m.t1.color==='#fbbf24'?'#000':'#fff';
  const txtColor2=m.t2.color==='#FFFFFF'||m.t2.color==='#fbbf24'?'#000':'#fff';
  document.getElementById('startButtons').innerHTML=`<button class="btn" style="background:${m.t1.color};color:${txtColor1};width:100%;padding:30px;font-size:1.3rem;font-weight:800" onclick="selectStarter(1)">${m.t1.name}</button><button class="btn" style="background:${m.t2.color};color:${txtColor2};width:100%;padding:30px;font-size:1.3rem;font-weight:800" onclick="selectStarter(2)">${m.t2.name}</button>`;
  
  document.getElementById('startPhase').style.display='block';
  document.getElementById('gamePhase').style.display='none';
  document.getElementById('launchBtn').style.display='none';
  
  updateTimer();
  updateScores();
  showPage('p4');
}

function selectStarter(team){
  state.possession=team;
  const btns=document.querySelectorAll('#startButtons .btn');
  btns.forEach((btn,i)=>{
    btn.style.opacity=i+1===team?'1':'.5';
  });
  document.getElementById('launchBtn').style.display='block';
}

function launchMatch(){
  state.matchStarted=true;
  state.possessions1=state.possession===1?1:0;
  state.possessions2=state.possession===2?1:0;
  
  document.getElementById('startPhase').style.display='none';
  document.getElementById('gamePhase').style.display='block';
  
  updateScores();
  updatePossession();
  startTimer();
}

function updateScores(){
  document.getElementById('score1').textContent=state.score1;
  document.getElementById('score2').textContent=state.score2;
}

function updatePossession(){
  const m=state.matches[state.currentMatchIdx];
  const zone=document.getElementById('possessionZone');
  const teamName=document.getElementById('possessionTeam');
  
  if(state.possession===1){
    zone.style.background=m.t1.color;
    teamName.textContent=m.t1.name;
  }else{
    zone.style.background=m.t2.color;
    teamName.textContent=m.t2.name;
  }
}

function scoreGoal(){
  if(!state.matchStarted)return;
  if(state.possession===1){
    state.score1+=state.pointsPerGoal;
    state.shots1++;
  }else{
    state.score2+=state.pointsPerGoal;
    state.shots2++;
  }
  state.possession=state.possession===1?2:1;
  if(state.possession===1)state.possessions1++;
  else state.possessions2++;
  updateScores();
  updatePossession();
}

function missedShot(){
  if(!state.matchStarted)return;
  if(state.possession===1){
    state.missedShots1++;
  }else{
    state.missedShots2++;
  }
  state.possession=state.possession===1?2:1;
  if(state.possession===1)state.possessions1++;
  else state.possessions2++;
  updatePossession();
}

function turnover(){
  if(!state.matchStarted)return;
  state.possession=state.possession===1?2:1;
  if(state.possession===1)state.possessions1++;
  else state.possessions2++;
  updatePossession();
}

function updateTimer(){
  const mins=Math.floor(state.timeLeft/60);
  const secs=state.timeLeft%60;
  document.getElementById('timer').textContent=`${mins}:${secs<10?'0':''}${secs}`;
}

function startTimer(){
  if(state.timerRunning)return;
  state.timerRunning=true;
  state.timerInterval=setInterval(()=>{
    state.timeLeft--;
    updateTimer();
    if(state.timeLeft<=0){
      stopTimer();
      endMatch();
    }
  },1000);
}

function stopTimer(){
  if(!state.timerRunning)return;
  state.timerRunning=false;
  clearInterval(state.timerInterval);
}

function endMatch(){
  stopTimer();
  const m=state.matches[state.currentMatchIdx];
  m.s1=state.score1;
  m.s2=state.score2;
  m.winner=state.score1>state.score2?1:(state.score2>state.score1?2:0);
  m.played=true;
  m.stats={shots1:state.shots1,shots2:state.shots2,poss1:state.possessions1,poss2:state.possessions2,missedShots1:state.missedShots1,missedShots2:state.missedShots2};
  
  backToTournament();
}

function backToTournament(){
  stopTimer();
  updateRanking();
  updateMatches();
  showPage('p3');
}

function resetTournament(){
  state={
    numTeams:4,duration:5,pointsPerGoal:1,
    teams:[],matches:[],currentMatchIdx:null,score1:0,score2:0,possession:1,
    matchStarted:false,timeLeft:300,timerInterval:null,timerRunning:false,
    shots1:0,shots2:0,possessions1:0,possessions2:0,missedShots1:0,missedShots2:0
  };
  document.getElementById('dur').textContent='5';
  document.getElementById('pts').textContent='1';
  setTeams(4);
  showPage('p1');
}

function showPage(pageId){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
}
</script>
</body>
</html>
